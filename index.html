<html>
    <head>
        <title>StormWatch</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script src="http://code.highcharts.com/highcharts.js"></script>
        <script>
            var socket = io.connect('http://localhost:3000'),
                charts = {},
                subtitleString;

            socket.on('newData', function(newData){
                for (metricName in newData) {
                    dataArray = [];
                    subtitleString = newData[metricName].metricType+', interval '+newData[metricName].interval+'s';
                    newData[metricName].datapoints.forEach(function(pnt){
                        var date = new Date(pnt.timestamp);
                        dataArray.push([date.getTime(), parseFloat(pnt.value, 10)])
                    });
                    charts[metricName] = new Highcharts.Chart({
                        chart: {
                            renderTo: metricName,
                            type: 'spline',
                            inverted: false,
                            width: 500,
                            style: {
                                margin: '0 auto'
                            }
                        },
                        title: {
                            text: newData[metricName].name
                        },
                        subtitle: {
                            text: subtitleString
                        },
                        xAxis: {
                            type: 'datetime',
                            title: {
                                enabled: true,
                                text: 'Time'
                            }
                        },
                        yAxis: {
                            title: {
                                text: metricName
                            },
                            labels: {
                                formatter: function() {
                                    return this.value + newData[metricName].unitLabel;
                                }
                            },
                            min: newData[metricName].range[0],
                            max: newData[metricName].range[1]
                        },
                        legend: {
                            enabled: false
                        },
                        series: [{
                            data: dataArray
                        }]
                    });

                }
 
            });

            $(document).ready(function(){
                $("#timeRange").change(function(){
                    var newRange = $("#timeRange").val();
                    socket.emit('changeParams', {
                        'timeRange': newRange
                    })
                })
            })

        </script>

    </head>
    <body>
        minutes: 
        <select id="timeRange">
            <option value="30">30</option>
            <option value="60">60</option>
            <option value="120">120</option>
            <option value="240">240</option>
        </select>
        <br>
        <div id="ELBLatency" style="height: 400px"></div>​
        <div id="ELBRequestCount" style="height: 400px"></div>​
        <div id="ELBHealthyHostCount" style="height: 400px"></div>​
<!--         <div id="ELBUnhealthyHostCount" style="height: 400px"></div>​
        <div id="ELBServerErrors" style="height: 400px"></div>​ -->
    </body>
</html>