<html>
    <head>
        <title>StormWatch</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script src="http://code.highcharts.com/highcharts.js"></script>
        <script>
            var socket = io.connect('http://localhost:3000'),
                charts = {},
                subtitleString, timeRange;

            socket.on('newData', function(newData){
                $("#loading").text('');
                for (metricName in newData) {
                    dataArray = [];
                    subtitleString = newData[metricName].metricType+
                    ', past '+$("#timeRange").val();
                    newData[metricName].datapoints.forEach(function(pnt){
                        var date = new Date(pnt.timestamp);
                        dataArray.push([date.getTime(), parseFloat(pnt.value, 10)])
                    });
                    charts[metricName] = new Highcharts.Chart({
                        chart: {
                            renderTo: metricName,
                            type: 'spline',
                            inverted: false,
                            width: 500,
                            style: {
                                margin: '0 auto'
                            }
                        },
                        title: {
                            text: newData[metricName].prefix+' '+newData[metricName].metricName
                        },
                        subtitle: {
                            text: subtitleString
                        },
                        xAxis: {
                            type: 'datetime',
                            title: {
                                enabled: true,
                                text: 'Time'
                            }
                        },
                        yAxis: {
                            title: {
                                text: newData[metricName].metricName
                            },
                            labels: {
                                formatter: function() {
                                    return this.value + newData[metricName].unitLabel;
                                }
                            },
                            min: newData[metricName].range[0],
                            max: newData[metricName].range[1]
                        },
                        legend: {
                            enabled: false
                        },
                        series: [{
                            data: dataArray
                        }]
                    });

                }
 
            });

            $(document).ready(function(){
                $("#timeRange").change(function(){
                    requestData('basic');
                })

                requestData('basic');
                setInterval(function(){
                    requestData('basic');
                }, 60000);
            })

            function requestData(view) {
                timeRange = $("#timeRange").val();
                socket.emit('requestData', {
                    'timeRange': timeRange,
                    'view': view
                });
                $("#loading").text('loading...');
            }

        </script>

    </head>
    <body>
        time range: 
        <select id="timeRange">
            <option value="30m">30m</option>
            <option value="1h">1h</option>
            <option value="2h">2h</option>
            <option value="4h">4h</option>
            <option value="12h">12h</option>
            <option value="1d">1d</option>
            <option value="7d">7d</option>
        </select>
        <span id="loading"></span>
        <br>
        <div id="ELBLatency" style="height: 400px"></div>​
        <div id="ELBRequestCount" style="height: 400px"></div>​
        <div id="ELBHealthyHostCount" style="height: 400px"></div>​
        <div id="EC2CPUUtilization" style="height: 400px"></div>
<!--         <div id="ELBUnhealthyHostCount" style="height: 400px"></div>​
        <div id="ELBServerErrors" style="height: 400px"></div>​ -->
    </body>
</html>